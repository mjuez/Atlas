/**
 * @author : gherardo varando (gherardo.varando@gmail.com)
 *
 * @license: GPL v3
 *     This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
 */

"use strict";

const ToggleElement = require('ToggleElement');

/**
 * Class representing an HTML element to select a file.
 *
 * @class FileSelector
 * @extends {ToggleElement}
 */
class FileSelector extends ToggleElement {

    /**
     * Creates a FileSelector.
     *
     * @param {string} id - HTML element id.
     */
    constructor(id,options) {

        options = options || {};
        let element = document.createElement("DIV");
        id = id || "fileinput";
        super(element);

        this.outputFilePath = undefined;

        this.fileInput = document.createElement("INPUT");
        this.fileInput.id = id;
        this.fileInput.type = "file";
        this.fileInput.className = "folderselector";
        this.fileInput.webkitdirectory = true;
        element.appendChild(this.fileInput);

        let btnSelectFile = document.createElement("BUTTON");
        btnSelectFile.className = "btn btn-default";
        btnSelectFile.innerHTML = "<span class=\"fa fa-file-open\"></span> Choose file";
        btnSelectFile.onclick = (e) => {
            this.fileInput.click();
        };
        element.appendChild(btnSelectFile);

        this.selectedFile = document.createElement("DIV");
        this.selectedFile.innerHTML = options.label || "Please, choose an output file.";
        element.appendChild(this.selectedFile);

        this.fileInput.onchange = (e) => {
            if (this.fileInput.files[0]) {
                this.outputFilePath = this.fileInput.files[0].path;
                this.selectedFile.innerHTML = this.outputFilePath;
            }
        };
    }

    /**
     * Gets the selected file path.
     *
     * @returns {string} a path to the selected file.
     */
    getFileRoute() {
        return this.outputFilePath;
    }

}

module.exports = FileSelector;
